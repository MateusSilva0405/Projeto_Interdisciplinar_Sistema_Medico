<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Consultas por Médico</title>
    <meta charset="UTF-8">
</head>
<body>
    <h1>Consultas por Médico</h1>
    <form th:action="@{/consultas/listar-nome-medico}" method="get" class="filter-container">
        <label>Selecione um médico:</label>
        <select id="medicoSelect" name="medico" onchange="filtrarConsultas()">
            <option value="">Selecione...</option>
            <option th:each="${m:${medico}}" th:value="${m.idMedico}" th:text="${m.nomeMedico}" th:selected="${m.idMedicoSelecionado == m.idMedico}"></option>
            </select>

            <button type="submit">Filtrar</button>
    </form>

    <div id="consultasMedico">
        <!-- Aqui aparecerá a tabela apenas do médico selecionado -->
        <table border="1" id="tabelaConsultas" style="display:none;">
            <thead>
                <tr>
                    <th>Nome do Médico</th>
                    <th>Especialidade</th>
                    <th>Observação da Consulta</th>
                    <th>Abrir detalhes</th>
                </tr>
            </thead>
            <tbody id="tbodyConsultas">
            </tbody>
        </table>
    </div>

    <script>
        // Captura a lista de consultas JavaScript
        var consultas = /*[[${consultas}]]*/ [];
        // Thymeleaf fallback para non-inline
        if (!Array.isArray(consultas)) {
            consultas = [];
        }

        function filtrarConsultas() {
            var select = document.getElementById('medicoSelect');
            var medicoSelecionado = select.value;
            var tabela = document.getElementById('tabelaConsultas');
            var tbody = document.getElementById('tbodyConsultas');
            tbody.innerHTML = '';
            if (!medicoSelecionado) {
                tabela.style.display = 'none';
                return;
            }
            var filtrados = consultas.filter(function(c) {
                return c.nomeMedico === medicoSelecionado;
            });
            filtrados.forEach(function(c) {
                var tr = document.createElement('tr');
                tr.innerHTML = '<td>' + c.nomeMedico + '</td>' +
                               '<td>' + c.especialidadeMedico + '</td>' +
                               '<td>' + c.obsConsulta + '</td>' +
                               '<td><a href="/medicoConsulta?medico=' + encodeURIComponent(c.nomeMedico) + '">Detalhes</a></td>';
                tbody.appendChild(tr);
            });
            tabela.style.display = filtrados.length > 0 ? '' : 'none';
        }
    </script>
</body>
</html>